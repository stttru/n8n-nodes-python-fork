# Variable Validation Fixes - v1.12.8

## Проблема
В предыдущих версиях узел мог генерировать Python скрипты с синтаксическими ошибками, когда входные данные содержали:
- Пустые ключи (`""`)
- Ключи только с пробелами (`"   "`)
- Ключи, начинающиеся с цифр (`"123abc"`)
- Ключи с недопустимыми символами (`"invalid-name"`, `"@#$%"`)

Это приводило к ошибкам типа:
```
SyntaxError: invalid syntax
 = ""
```

## Исправления

### 1. Добавлена функция `sanitizeVariableName()`
```typescript
function sanitizeVariableName(key: string, prefix = 'var'): string | null {
    // Пропускаем пустые ключи
    if (!key || key.trim() === '') {
        return null;
    }
    
    // Заменяем недопустимые символы на подчеркивания
    let safeVarName = key.replace(/[^a-zA-Z0-9_]/g, '_');
    
    // Добавляем префикс если имя начинается с цифры
    if (!/^[a-zA-Z_]/.test(safeVarName)) {
        safeVarName = `${prefix}_${safeVarName}`;
    }
    
    // Пропускаем если после санитизации имя невалидно
    if (!safeVarName || safeVarName.trim() === '' || safeVarName === `${prefix}_`) {
        return null;
    }
    
    return safeVarName;
}
```

### 2. Улучшена генерация переменных из входных данных
- Используется `sanitizeVariableName()` для всех ключей
- Пропускаются невалидные ключи вместо создания ошибочного кода
- Добавлены проверки для предотвращения пустых присваиваний

### 3. Улучшена генерация переменных окружения
- Применена та же валидация к переменным из credentials
- Пропускаются невалидные ключи из переменных окружения
- Сохранена совместимость с существующими конфигурациями

### 4. Добавлена дополнительная проверка синтаксиса
В функции `getTemporaryScriptPath()` добавлена проверка:
```typescript
// Проверка на недопустимые присваивания переменных
if (line.match(/^\s*=\s*/) || line.match(/^[^a-zA-Z_]\w*\s*=/)) {
    throw new Error(`Invalid variable assignment detected at line ${i + 1}: "${line}"`);
}
```

## Примеры обработки

### До исправления:
```python
# Генерировался невалидный код:
= "empty_key_value"        # SyntaxError!
123abc = "numeric_value"   # SyntaxError!
```

### После исправления:
```python
# Пустые ключи пропускаются
# Числовые ключи получают префикс:
var_123abc = "numeric_value"
# Недопустимые символы заменяются:
invalid_name = "hyphen_value"
```

## Тестирование
Создан тестовый скрипт `test_variable_validation.py` который проверяет:
- ✅ Санитизацию имен переменных
- ✅ Обработку проблематичных входных данных
- ✅ Паттерны валидации синтаксиса

## Совместимость
- ✅ Полная обратная совместимость
- ✅ Существующие рабочие скрипты продолжают работать
- ✅ Улучшена обработка ошибочных данных
- ✅ Более понятные сообщения об ошибках

## Результат
Узел теперь устойчив к некорректным входным данным и не генерирует Python скрипты с синтаксическими ошибками. 